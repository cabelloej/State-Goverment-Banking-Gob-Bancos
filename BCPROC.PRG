PROCEDURE INDICES
DEFI WIND WININD FROM 05,50 TO 07,72 ;
                 TITLE " REORGANIZAR " ;
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WININD
@ 0,0 CLEAR
store 2 to wop
do while .t.
   store space(10) to wclaveind
   @ 00,00  say "Clave:" get wclaveind
   read
   if UPPER(wclaveind)<>"EJCM      "
      exit
   endif
   @ 00,00  get wop pict "@*H Aceptar ;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
if wop=1
   @ 00,00 
   @ 00,00 SAY "Favor esperar..."
else
   RELE WIND WININD
   RETURN
endif
CLOSE DATA
CLOSE INDEX
***
USE BCBANCOS
DO FILLOC
INDEX ON BANCO TO BCBANCOS
UNLOCK ALL
***
USE BCSUCUR
DO FILLOC
INDEX ON BANCO+SUCURSAL TO BCSUCUR
UNLOCK ALL
***
USE BCTIPCTA
DO FILLOC
INDEX ON TIPO TO BCTIPCTA
UNLOCK ALL
***
USE BCCTAS
DO FILLOC
INDEX ON CTA TO BCCTAS
INDEX ON BANCO+NUMEROCTA TO BCCTAS2
UNLOCK ALL
***
USE BCSUBCTA
DO FILLOC
INDEX ON CTA+SUBCTA TO BCSUBCTA
UNLOCK ALL
***
USE BCPARTID
DO FILLOC
INDEX ON ANO+TIP+ORG TO BCPARTID
UNLOCK ALL
***
USE BCREFER
DO FILLOC
INDEX ON CODIGO TO BCREFER
UNLOCK ALL
***
USE PRBENEF
DO FILLOC
INDEX ON CODIGO TO PRBENEF1
INDEX ON DESCRI TO PRBENEF2
UNLOCK ALL
***
USE BCOPECTA
DO FILLOC
INDEX ON OPERADOR+CTA TO BCOPECTA
UNLOCK ALL
***
USE BCOPERA
DO FILLOC
*** INDICE DE CRONOLOGICO DE OPERACION [NO0200]
INDEX ON CTA+SUBCTA+STR(YEAR(FECHA))+STR(MONTH(FECHA))+STR(DAY(FECHA))+SERIAL TO BCOPERA1

*** INDICE DE VERIFICACION DE OPERACIONES POR CTA [NO0201 , NO0202 y NO0500]
INDEX ON CTA+TIPOPE+NUMOPE TO BCOPERA2

*** INDICE DE SALDO POR CUENTA [NO0404]
*          DE ORDEN DE MOVIMIENTOS [BC0300]
*          DE MOVIMIENTOS NO CONCILIADOS [BC0405]
INDEX ON CTA+STR(YEAR(FECHA))+STR(MONTH(FECHA))+STR(DAY(FECHA))+SERIAL TO BCOPERA3

*** INDICE CRONOLOGICO DE CONCILIACION [NO0405]
INDEX ON CTA+STR(YEAR(ESTATFECHA))+STR(MONTH(ESTATFECHA))+STR(DAY(ESTATFECHA)) TO BCOPERA4

*** INDICE DE BUSQUEDA DIRECTA DE OPERACIONES EN CONCILIACION [NO0300]
INDEX ON SERIAL TO BCOPERA5

***
STORE "EL SISTEMA SE REINICIARA, OPRIMA <ENTER> PARA CONTINUAR." TO WTEXT
DO AVISO2 WITH WTEXT
RELE WIND WININD
CLOSE DATA
CLOSE INDEX
SET PROC TO SYSPROC
RETURN TO MASTER
*****************
PROCEDURE COMPACTA
DEFI WIND WINCOM FROM 05,50 TO 07,72 ;
                 TITLE " COMPACTAR " ;
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINCOM
@ 0,0 CLEAR
store 2 to wop
do while .t.
   store space(10) to wclaveind
   @ 00,00  say "Clave:" get wclaveind
   read
   if UPPER(wclaveind)<>"EJCM      "
      exit
   endif
   @ 00,00  get wop pict "@*H Aceptar ;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
if wop=1
   @ 00,00 
   @ 00,00 SAY "Favor esperar..."
else
   RELE WIND WINCOM
   RETURN
endif
***
CLOSE DATA
CLOSE INDEX
***
USE BCBANCOS INDEX BCBANCOS EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE BCSUCUR INDEX BCSUCUR   EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE BCTIPCTA INDEX BCTIPCTA EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE BCCTAS INDEX BCCTAS, BCCTAS2  EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE BCSUBCTA INDEX BCSUBCTA EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE BCPARTID INDEX BCPARTID EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE BCREFER INDEX BCREFER EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE BCBENEFI  INDEX BCBENEF1,BCBENEF2 EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE BCOPECTA INDEX BCOPECTA EXCL
DO FILLOC
PACK
UNLOCK ALL
***
USE BCOPERA INDEX BCOPERA1,BCOPERA2,BCOPERA3,BCOPERA4,BCOPERA5 EXCL
DO FILLOC
PACK
***
STORE "EL SISTEMA SE REINICIARA, OPRIMA <ENTER> PARA CONTINUAR." TO WTEXT
DO AVISO2 WITH WTEXT
RELE WIND WINCOM
CLOSE DATA
CLOSE INDEX
SET PROCEDURE TO SYSPROC
RETURN TO MASTER
****************
PROCEDURE RECLOC
SAVE SCRE TO SCRE1
STORE .T. TO WRECLOC
STORE .T. TO WFLAGMES
DO WHILE WRECLOC
   IF RLOCK()
      EXIT
   ELSE
      IF WFLAGMES
         @ 12,05 CLEAR TO 18,75
         @ 12,05 TO 18,75
         @ 14,15 SAY "REGISTRO OCUPADO POR OTRO USUARIO, REINTENTANDO ..."
         @ 16,15 SAY "          OPRIMA [ESC] PARA ABANDONAR              "
         STORE .F. TO WFLAGMES
      ENDIF
      WVALUE = INKEY()
      IF WVALUE = 27
         store .t. to wjumping
         close data
         close index
         RETURN TO MASTER
      ENDIF
   ENDIF
ENDDO
RESTORE SCRE FROM SCRE1
RETURN
*************************
PROCEDURE FILLOC
SAVE SCRE TO SCRE1
STORE .T. TO WFILLOC
STORE .T. TO WFLAGMES
DO WHILE WFILLOC
   IF FLOCK()
      EXIT
   ELSE
      IF WFLAGMES
         @ 12,05 CLEAR TO 18,75
         @ 12,05 TO 18,75
         @ 14,15 SAY "ARCHIVO OCUPADO POR OTRO USUARIO, REINTENTANDO ..."
         @ 16,15 SAY "          OPRIMA [ESC] PARA ABANDONAR             "
         STORE .F. TO WFLAGMES
      ENDIF
      WVALUE = INKEY()
      IF WVALUE = 27
         store .t. to wjumping
         close data
         close index
         RETURN TO MASTER
      ENDIF
   ENDIF
ENDDO
RESTORE SCRE FROM SCRE1
RETURN
*************************
PROCEDURE PREGUNTA
STORE .T. TO WPREG
DO WHILE WPREG
   @ 23,0
   STORE SUBSTR(WCH,1,1) TO WCHOICE
   @ 23,40- (LEN(TEX)/2) SAY TEX GET WCHOICE
   READ
   IF LASTKEY()=27
      LOOP
   ENDIF
   STORE UPPER(WCHOICE) TO WCHOICE
   IF AT(WCHOICE,WCH) > 0
      STORE .F. TO WPREG
      EXIT
   ENDIF
ENDDO
@ 23,0
STORE WCHOICE TO WCH
RETURN
*************************
PROCEDURE MENSAJE
PARAMETERS MES
SET COLOR TO
@ 23,0
@ 23,40-(LEN(MES)/2) SAY MES
RETURN
*************************
PROCEDURE AVISO
PARAMETERS MES
STORE " " TO X
SET COLOR TO
?? CHR(7)
@ 23,0
@ 23,40-(LEN(MES)/2) SAY MES GET X
READ
@ 23,1
RETURN
*************************
PROCEDURE CHKPRINT
PARAMETERS SALTAR
store .t. to wprinting
do while wprinting
   store "Prepare la impresora y oprima <ENTTER> para continuar o (R)echazar" to Qmes
   @ 23,1
   @ 23,40-(len(Qmes)/2) say Qmes
   store " " to wstat
   @ 23,78 get wstat
   read
   if upper(wstat) = "R"
      store 1 to saltar
      store .f. to wprinting
   else
      store 0 to saltar
      if sys(13) = "READY"
         store .f. to wprinting
      endif
   endif
   @ 23,1
enddo
RETURN
*************************
PROCEDURE ACCESO
PARAMETERS WPROGACC,WFLAGACC
STORE .T. TO WFLAGACC
IF USUARIOS->USERPRO <> SPACE(2)
   IF USUARIOS->USERPRO = "**"
      IF WPROGACC <> "05" .AND. PROGACC <> "12"
         STORE .F. TO WFLAGACC
      ENDIF
   ELSE
      IF USUARIOS->USERPRO <> WPROGACC
         STORE .F. TO WFLAGACC
      ENDIF
   ENDIF
ENDIF
RETURN
*************************
PROCEDURE STRNUMBER
STORE LEN(RTRIM(LTRIM(STR(WNUMBERN,12)))) TO WNUMLEN
STORE REPLICATE("0",12-WNUMLEN)+LTRIM(STR(WNUMBERN,12)) TO WNUMBERC
RETURN
*************************
PROCEDURE MONTOESC
* CALCULO DEL MONTO ESCRITO
STORE WMONTOESC TO WNETO
STORE WMONTOESC TO WMONTO
STORE INT(WMONTO/1000000) TO MILLONES
STORE WMONTO-MILLONES*1000000 TO WMONTO
STORE INT(WMONTO/1000) TO MILES
STORE WMONTO-MILES*1000 TO WMONTO
STORE INT(WMONTO/100) TO CIENTOS
STORE WMONTO-CIENTOS*100 TO WMONTO
STORE INT(WMONTO/10) TO DECENAS
STORE WMONTO-DECENAS*10 TO WMONTO
STORE INT(WMONTO/1) TO UNIDADES
STORE WMONTO-UNIDADES*1 TO WMONTO
STORE (WNETO-INT(WNETO))*100 TO CENTIMOS
SELECT 10
***** MILLONES ******
GO TOP
LOCATE FOR VALOR > MILLONES
IF .NOT. FOUND()
   STORE "ERROR, NO ENCONTRE LOS MILLONES APROPIADOS" TO MES
   DO AVISO WITH MES
ENDIF
GO RECNO()-1
IF VALOR > 0
   STORE RTRIM(Wescrito)+" "+DES TO Wescrito
ENDIF
STORE MILLONES-VALOR TO RESTO
STORE .T. TO CHECKREST
DO WHILE CHECKREST
   GO TOP
   IF RESTO = 0
      STORE .F. TO CHECKREST
      LOOP
   ENDIF
   LOCATE FOR VALOR > RESTO
   IF .NOT. FOUND()
      STORE "ERROR, NO ENCONTRE EL RESTO DE LOS MILLONES APROPIADOS" TO MES
      DO AVISO WITH MES
   ENDIF
   GO RECNO()-1
   STORE RTRIM(Wescrito)+" Y "+DES TO Wescrito
   STORE RESTO-VALOR TO RESTO
ENDDO
IF MILLONES = 1
   STORE RTRIM(Wescrito)+" MILLON " TO Wescrito
ELSE
   IF MILLONES > 1
      STORE RTRIM(Wescrito)+" MILLONES " TO Wescrito
   ENDIF
ENDIF
***** MILES ******
GO TOP
LOCATE FOR VALOR > MILES
IF .NOT. FOUND()
   STORE "ERROR, NO ENCONTRE LOS MILES APROPIADOS" TO MES
   DO AVISO WITH MES
ENDIF
GO RECNO()-1
IF VALOR > 0
   STORE RTRIM(Wescrito)+" "+DES TO Wescrito
ENDIF
STORE MILES-VALOR TO RESTO
IF MILES >= 100 .AND. MILES < 200 .AND. RESTO > 0
   STORE RTRIM(Wescrito)+"TO" TO Wescrito
ENDIF
STORE .T. TO CHECKREST
DO WHILE CHECKREST
   GO TOP
   IF RESTO = 0
      STORE .F. TO CHECKREST
      LOOP
   ENDIF
   LOCATE FOR VALOR > RESTO
   IF .NOT. FOUND()
      STORE "ERROR, NO ENCONTRE EL RESTO DE LOS MILES APROPIADOS" TO MES
      DO AVISO WITH MES
   ENDIF
   GO RECNO()-1
   STORE RTRIM(Wescrito)+" "+DES TO Wescrito
   STORE RESTO-VALOR TO RESTO
ENDDO
IF MILES > 0
   STORE RTRIM(Wescrito)+" MIL " TO Wescrito
ENDIF

***** CIENTOS ****
GO TOP
LOCATE FOR VALOR > CIENTOS*100
IF .NOT. FOUND()
   STORE "ERROR, NO ENCONTRE LOS CIENTOS APROPIADOS" TO MES
   DO AVISO WITH MES
ENDIF
GO RECNO()-1
IF VALOR > 0
   STORE RTRIM(Wescrito)+" "+DES TO Wescrito
ENDIF
IF CIENTOS = 1 .AND. DECENAS*10+UNIDADES > 0
   STORE RTRIM(Wescrito)+"TO" TO Wescrito
ENDIF

***** DECENAS ****
IF DECENAS > 1
   GO TOP
   LOCATE FOR VALOR > DECENAS*10
   IF .NOT. FOUND()
      STORE "ERROR, NO ENCONTRE LAS DECENAS APROPIADAS" TO MES
      DO AVISO WITH MES
   ENDIF
   GO RECNO()-1
   IF VALOR > 0
      STORE RTRIM(Wescrito)+" "+DES TO Wescrito
   ENDIF
ELSE
   STORE DECENAS*10+UNIDADES TO UNIDADES
ENDIF

***** UNIDADES ****
GO TOP
LOCATE FOR VALOR > UNIDADES
IF .NOT. FOUND()
   STORE "ERROR, NO ENCONTRE LAS UNIDADES APROPIADAS" TO MES
   DO AVISO WITH MES
ENDIF
GO RECNO()-1
IF VALOR > 0
   STORE RTRIM(Wescrito)+" Y "+DES TO Wescrito
ENDIF
STOR UNIDADES-VALOR TO RESTO
STORE .T. TO CHECKREST
DO WHILE CHECKREST
   GO TOP
   IF RESTO = 0
      STORE .F. TO CHECKREST
      LOOP
   ENDIF
   LOCATE FOR VALOR > RESTO
   IF .NOT. FOUND()
      STORE "ERROR, NO ENCONTRE EL RESTO DE LAS UNIDADES APROPIADAS" TO MES
      DO AVISO WITH MES
   ENDIF
   GO RECNO()-1
   STORE RTRIM(Wescrito)+" Y "+DES TO Wescrito
   STORE RESTO-VALOR TO RESTO
ENDDO
STORE RTRIM(Wescrito)+" Bolivares con " TO Wescrito

***** CENTIMOS ****
STORE RTRIM(Wescrito)+" "+LTRIM(RTRIM(STR(CENTIMOS,5)))+"/100" TO Wescrito
RETURN
*************************
PROCEDURE AVISO2
PARAMETERS WTEXT
DEFI WIND WINAVI FROM 22,0 TO 24,79 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINAVI
?? CHR(7)
@ 0,40-(LEN(WTEXT)/2) SAY WTEXT
READ
RELE WIND WINAVI
RETURN
*************************
PROCEDURE CHKACC
PARAMETERS WUSERCODE,WPROGRAMA,WACCESO,WFILTRO
SELECT SYSUSERD
STORE WUSERCODE+WPROGRAMA TO WCLAVEACC
SEEK WCLAVEACC
IF FOUND()
   STORE ACCESO TO WACCESO
   STORE FILTRO TO WFILTRO
ENDIF
RETURN
*************************
procedure informa
store " " to qw1
store " " to qw2
store " " to qw3
store " " to qw4
store " " to qw5
store " " to qw6
store " " to qw7
store " " to qw8
store " " to qw9
store " " to qw10
store " " to qw11
store " " to qw12
store " " to qw13
store " " to qw14
store " " to qw15
store " " to qw16
store " " to qw17
store " " to qw18
store " " to qw19
store " " to qw20
store " " to qw21
store " " to qw22
store " " to qw23
store " " to qw24
store " " to qw25
store " " to qw26
store " " to qw27
store " " to qw28
store " " to qw29
store " " to qw30
store " " to qw31
store " " to qw32
store " " to qw33
store " " to qw34
store "R" to qw35
store "U" to qw36
store "S" to qw37
store "A" to qw38
store "M" to qw39
store "I" to qw40
STORE QW40+QW39+QW38+QW37+QW36+QW35+QW34+QW33+QW32+QW31+QW30+QW29+QW28 TO QQWW
STORE QQWW+QW27+QW26+QW25+QW24+QW23+QW22+QW21+QW20+QW19+QW18+QW17+QW16 TO QQWW
STORE QQWW+QW15+QW14+QW13+QW12+QW11+QW10+QW9+QW8+QW7+QW6+QW5+QW4+QW3+QW2+QW1 TO QQWW
RETURN
*************************
