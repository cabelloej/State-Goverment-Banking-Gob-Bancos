SELECT 1
USE BCBANCOS INDEX BCBANCOS ALIAS BANCOS
SELECT 2
USE BCCTAS INDEX BCCTAS  ALIAS CUENTAS
SELECT 3
USE BCSUBCTA INDEX BCSUBCTA  ALIAS SUBCTAS
SELECT 4
USE BCPARTID INDEX BCPARTID  ALIAS CLASIFI
SELECT 5
USE BCTIPCTA INDEX BCTIPCTA  ALIAS TIPOS
STORE .T. TO WIMP
DO WHILE WIMP
   @ 04,0 CLEAR TO 14,50
   @ 04,0 SAY "SALDOS POR CLASIFICACION"
   @ 05,0       TO 14,50
   @ 06,2 SAY "GRUPO     :"
   @ 08,2 SAY "SUBGRUPO  :"
   @ 10,2 SAY "RENGLON   :"
   @ 12,2 SAY "SALIDA    :"
   STORE SPACE(2) TO XGRUPO
   STORE SPACE(2) TO XSUBGRUPO
   STORE SPACE(3) TO XRENGLON
   @ 06,14 GET XGRUPO
   READ
   IF READKEY()=12.OR. READKEY()=268
      EXIT
   ENDIF
   IF XGRUPO<>SPACE(2)
      SELECT CLASIFI
      STORE XGRUPO+SPACE(5) TO WCLAVEGRU
      FIND &WCLAVEGRU
      IF EOF()
         STORE "GRUPO NO REGISTRADO, VERIFIQUE" TO MES
         DO AVISO WITH MES
         LOOP
      ELSE
         @ 06,20 SAY DESCRI
      ENDIF

      @ 08,14 GET XSUBGRUPO
      READ
      IF READKEY()=12.OR. READKEY()=268
         LOOP
      ENDIF
      IF XSUBGRUPO<>SPACE(2)
         SELECT CLASIFI
         STORE XGRUPO+XSUBGRUPO+SPACE(3) TO WCLAVESUB
         FIND &WCLAVESUB
         IF EOF()
            STORE "SUBGRUPO NO REGISTRADO PARA ESTE GRUPO, VERIFIQUE" TO MES
            DO AVISO WITH MES
            LOOP
         ELSE
            @ 08,20 SAY DESCRI
         ENDIF
         @ 10,14 GET XRENGLON
         READ
         IF READKEY()=12.OR. READKEY()=268
            LOOP
         ENDIF
         IF XRENGLON<>SPACE(3)
            SELECT CLASIFI
            STORE XGRUPO+XSUBGRUPO+XRENGLON TO WCLAVEREN
            FIND &WCLAVEREN
            IF EOF()
               STORE "RENGLON NO REGISTRADO PARA ESTE SUBGRUPO, VERIFIQUE" TO MES
               DO AVISO WITH MES
               LOOP
            ELSE
               @ 10,20 SAY DESCRI
            ENDIF
         ELSE
            @ 10,20 SAY "TODOS LOS RENGLONES"
         ENDIF
      ELSE
         @ 08,20 SAY "TODOS LOS SUBGRUPOS"
      ENDIF
   ELSE
      @ 06,20 SAY "TODOS LOS GRUPOS"
   ENDIF

  * STORE "SELECCIONE LA SALIDA: (M)ONITOR, (I)MPRESORA" TO TEX
  * STORE "MI" TO WCH
  * DO PREGUNTA
  * IF READKEY()=12 .OR. READKEY()=268
  *    LOOP
  * ENDIF
   STORE "I" TO WSALIDA
   STORE 0   TO WPAGINA
   STORE 100 TO WLINEA
   IF WSALIDA = "I"
      STORE 55 TO WSALTO
      STORE "IMPRESORA" TO WSALIDES
   ELSE
      STORE 20 TO WSALTO
      STORE "MONITOR" TO WSALIDES
   ENDIF
   @ 12,14 SAY WSALIDES

   STORE "OPCIONES: (C)ONTINUAR, (S)ALIR" TO TEX
   STORE "CS" TO WCH
   DO PREGUNTA
   IF WCH = "S"
      LOOP
   ENDIF
   IF WSALIDA = "I"
      SET DEVI TO PRINT
   ELSE
      SET DEVI TO SCRE
   ENDIF

   STORE 0   TO PAGINA
   STORE 100 TO LINEA
   SELECT CLASIFI
   GO TOP
   DO WHILE .NOT. EOF()
      IF XGRUPO <> SPACE(2) .AND. XGRUPO <> ANO
         SELECT CLASIFI
         SKIP
         LOOP
      ENDIF
      IF XSUBGRUPO <> SPACE(2) .AND. XSUBGRUPO <> TIP
         SELECT CLASIFI
         SKIP
         LOOP
      ENDIF
      IF XRENGLON <> SPACE(3) .AND. XRENGLON <> ORG
         SELECT CLASIFI
         SKIP
         LOOP
      ENDIF
      STORE ANO TO WANO
      STORE TIP TO WTIP
      STORE ORG TO WORI
      STORE DESCRI TO WDESCRI
      STORE LINEA + 1 TO LINEA
      IF LINEA > WSALTO
         DO BC0315H
      ENDIF
      @ LINEA,00 SAY WANO+"-"+WTIP+"-"+WORI+"  "+WDESCRI

      STORE 0 TO WTOTINF
      STORE 0 TO WTOTREN
      SELECT CUENTAS
      GO TOP
      DO WHILE .NOT. EOF() .AND. ANO=WANO .AND. TIP=WTIP .AND. ORG=WORI
         STORE BANCO     TO WBANCO
         STORE CTA       TO WCTA
         STORE TIPO      TO WTIPO
         STORE NUMEROCTA TO WNUMCTA
        *STORE DESCRI    TO WDESCTA
         STORE CTA       TO WCLAVESUB
         STORE 0 TO WSALDOCTA

         SELECT SUBCTAS
         FIND &WCLAVESUB
         DO WHILE .NOT. EOF() .AND. CTA = WCTA 
            STORE WSALDOCTA + SALDO TO WSALDOCTA
            SKIP
         ENDDO
         STORE WTOTREN+WSALDOCTA TO WTOTREN
         STORE WTOTINF+WSALDOCTA TO WTOTINF
         IF WSALDOCTA>0
            STORE LINEA + 1 TO LINEA
            IF LINEA > WSALTO
               DO BC0315H
            ENDIF
            SELECT BANCOS
            FIND &WBANCO
            IF EOF()
               STORE "NO REGISTRADO" TO WBANDES
            ELSE
               STORE DESCRI TO WBANDES
            ENDIF
            SELECT TIPOS
            FIND &WTIPO
            IF EOF()
               STORE "NO REGISTRADO" TO WTIPDES
            ELSE
               STORE DESCRI TO WTIPDES
            ENDIF
            @ LINEA,00  SAY WCTA
            @ LINEA,10  SAY WBANDES
            @ LINEA,45  SAY WTIPDES
            @ LINEA,80  SAY WNUMCTA
            @ LINEA,115 SAY WSALDOCTA PICTURE "####,###,###.##"
         ENDIF
         SELECT CUENTAS
         SKIP
      ENDDO
      SELECT CLASIFI
      SKIP
   ENDDO
   IF WSALIDA = "M"
      STORE "OPRIMA <ENTER> PARA FINALIZAR" TO MES
      DO AVISO WITH MES
   ELSE
      EJECT
      SET DEVI TO SCRE
   ENDIF
ENDDO
CLOSE DATA
CLOSE INDEX
RETURN
