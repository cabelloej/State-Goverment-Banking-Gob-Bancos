SELECT 1
USE BCBANCOS INDEX BCBANCOS
SELECT 2
USE BCSUCUR  INDEX BCSUCUR
SELECT 3
USE BCTIPCTA INDEX BCTIPCTA
SELECT 4
USE BCCTAS   INDEX BCCTAS,BCCTAS2
SELECT 5
USE BCPARTID INDEX BCPARTID
SELECT 6
USE BCSUBCTA INDEX BCSUBCTA

STORE .T. TO WCARGANDO
DO WHILE WCARGANDO
   @ 4,0 CLEAR to 21,55
   @ 5,0 TO 21,55
   @ 04,00 SAY "CUENTAS BANCARIAS"
   @ 06,2 SAY "CUENTA  :"
   @ 08,2 SAY "TIPO    :"
   @ 10,2 SAY "NUMERO  :"
   @ 12,2 SAY "BANCO   :"
   @ 14,2 SAY "SUCURSAL:"
   @ 16,2 SAY "APERTURA:"
   @ 18,2 SAY "CLASIFIC:"
   @ 20,2 SAY "ULT.CHEQ:"
   @ 06,12 GET WCUENTA
   READ
   IF WCUENTA  = SPACE(4) .OR.READKEY()=12.OR.READKEY()=268
      EXIT
   ENDIF
   SELECT 4
   FIND &WCUENTA
   IF EOF()
      STORE .T. TO WINGRESA
      STORE .T. TO WMODIFICA
      STORE "CUENTA NO REGISTRADA, INGRESAR ? (S/N)" TO TEX
      STORE "SN" TO WCH
      DO PREGUNTA
      IF WCH = "N"
         LOOP
      ENDIF
      STORE SPACE(30)   TO WDESCRI
      STORE SPACE(20)   TO WNUMCTA
      STORE SPACE(2)    TO WTIPO
      STORE SPACE(4)    TO WBANCO
      STORE SPACE(4)    TO WSUCURSAL
      STORE SPACE(2)    TO WANO
      STORE SPACE(2)    TO WTIP
      STORE SPACE(3)    TO WORG
      STORE 0           TO WCHEQUE
      STORE DATE()      TO WAPERTURA
   ELSE
      STORE .F. TO WINGRESA
      STORE .F. TO WMODIFICA
      STORE DESCRI      TO WDESCRI
      STORE TIPO        TO WTIPO
      STORE BANCO       TO WBANCO
      STORE SUCURSAL    TO WSUCURSAL
      STORE NUMEROCTA   TO WNUMCTA
      STORE ANO         TO WANO
      STORE TIP         TO WTIP
      STORE ORG         TO WORG
      STORE APERTURA    TO WAPERTURA
      STORE CHEQUE      TO WCHEQUE
   ENDIF

   IF WBANCO <> SPACE(4)
      SELECT 1
      FIND &WBANCO
      IF EOF()
         STORE "NO REGISTRADO" TO WBANCODES
      ELSE
         STORE DESCRI          TO WBANCODES
      ENDIF
   ELSE
      STORE "NO DEFINIDO"      TO WBANCODES
   ENDIF

   IF WBANCO <> SPACE(4)
      STORE WBANCO+WSUCURSAL TO WCLAVE
      SELECT 2
      FIND &WCLAVE
      IF EOF()
         STORE "NO REGISTRADO" TO WSUCURDES
      ELSE
         STORE DESCRI          TO WSUCURDES
      ENDIF
   ELSE
      STORE "NO DIFINIDA"      TO WSUCURDES
   ENDIF

   IF WTIPO  <> SPACE(2)
      SELECT 3
      FIND &WTIPO
      IF EOF()
         STORE "NO REGISTRADO" TO WTIPODES
      ELSE
         STORE DESCRI          TO WTIPODES
      ENDIF
   ELSE
      STORE "NO DEFINIDO"      TO WTIPODES
   ENDIF

   STORE WANO+WTIP+WORG TO WPRESU
   IF WPRESU  <> SPACE(7)
      SELECT 5
      FIND &WPRESU
      IF EOF()
         STORE "NO REGISTRADO" TO WPRESUDES
      ELSE
         STORE DESCRI          TO WPRESUDES
      ENDIF
   ELSE
      STORE "NO DEFINIDO"      TO WPRESUDES
   ENDIF

   @ 06, 20  SAY WDESCRI
   @ 08, 12  SAY WTIPO
   @ 08, 20  SAY WTIPODES
   @ 10, 12  SAY WNUMCTA
   @ 12, 12  SAY WBANCO
   @ 12, 20  SAY WBANCODES
   @ 14, 12  SAY WSUCURSAL
   @ 14, 20  SAY WSUCURDES
   @ 16, 12  SAY WAPERTURA
   @ 18, 12  SAY WANO+"-"+WTIP+"-"+WORG
   @ 18, 25  SAY WPRESUDES
   @ 20, 12  SAY WCHEQUE PICTURE "############"

   IF .NOT. WMODIFICA
      STORE "OPCIONES: (M)ODIFICAR, (E)LIMINAR, (S)ALIR" TO TEX
      STORE "SME" TO WCH
      DO PREGUNTA
      STORE WCH TO WRESP
      IF WRESP= "S"
         LOOP
      ELSE
         IF WRESP= "M"
            STORE .T. TO WMODIFICA
         ELSE
            STORE "ESTA SEGURO QUE DESEA ELIMINAR ? (S/N)" TO TEX
            STORE "NS" TO WCH
            DO PREGUNTA
            IF WCH = "N"
               LOOP
            ELSE
               *** CHEQUEAR QUE LA SUCURSAL DEL BANCO ESTE SIN CONEXIONES EN BCOPERAC.DBF
               * SELECT 4
               * DELETE
               * LOOP
            ENDIF
         ENDIF
      ENDIF
   ENDIF

   IF WMODIFICA
      *** DESCRIPCION
      STORE .T. TO WACT
      DO WHILE WACT
         STORE "INGRESE LA DESCRIPCION DE LA CUENTA" TO MES
         DO MENSAJE WITH MES
         @ 6,20 GET WDESCRI
         READ
         IF READKEY()=12.OR.READKEY()=268
            STORE .F. TO WCARGANDO
            EXIT
         ENDIF
         IF WDESCRI <> SPACE(30)
            EXIT
         ENDIF
      ENDDO
      IF .NOT. WCARGANDO
         EXIT
      ENDIF
   ENDIF

   STORE .T. TO WVERTIPO
   STORE .T. TO WFLAGTIPO
   DO WHILE WVERTIPO
      STORE "INGRESE EL TIPO DE CUENTA BANCARIA" TO MES
      DO MENSAJE WITH MES
      @ 08,12 GET WTIPO
      READ
      SELECT 3
      FIND &WTIPO
      IF EOF()
         STORE "TIPO DE CUENTA NO DEFINIDO EN TIPOS, VERIFIQUE." TO MES
         DO AVISO WITH MES
         STORE .F. TO WVERTIPO
         STORE .F. TO WFLAGTIPO
      ELSE
         STORE DESCRI TO WDESTIPO
         STORE .F. TO WVERTIPO
      ENDIF
   ENDDO
   IF .NOT. WFLAGTIPO
      LOOP
   ENDIF
   @ 08,20 SAY WDESTIPO

   STORE .T. TO WVERNUMCTA
   DO WHILE WVERNUMCTA
      @ 10,12 GET WNUMCTA
      READ
      IF WNUMCTA <> SPACE(20)
         EXIT
      ENDIF
   ENDDO

   STORE .T. TO WVERBANCO
   STORE .T. TO WFLAGBANCO
   DO WHILE WVERBANCO
      STORE "INGRESE EL CODIGO DEL BANCO AL CUAL PERTENECE ESTA CUENTA" TO MES
      DO MENSAJE WITH MES
      @ 12,12 GET WBANCO
      READ
      SELECT 1
      FIND &WBANCO
      IF EOF()
         STORE "CODIGO DE BANCO NO DEFINIDO EN BANCOS, VERIFIQUE." TO MES
         DO AVISO WITH MES
         STORE .F. TO WVERBANCO
         STORE .F. TO WFLAGBANCO
      ELSE
         STORE DESCRI TO WDESBANCO
         STORE .F. TO WVERBANCO
      ENDIF
   ENDDO
   IF .NOT. WFLAGBANCO
      LOOP
   ENDIF
   @ 12,20 SAY WDESBANCO

   STORE .T. TO WVERSUCUR
   STORE .T. TO WFLAGSUCUR
   DO WHILE WVERSUCUR
      STORE "INGRESE EL CODIGO DE LA SUCURSAL AL CUAL PERTENECE ESTA CUENTA" TO MES
      DO MENSAJE WITH MES
      @ 14,12 GET WSUCURSAL
      READ
      SELECT 2
      STORE WBANCO+WSUCURSAL TO WCLAVE
      FIND &WCLAVE
      IF EOF()
         STORE "CODIGO DE SUCURSAL NO DEFINIDO EN SUCURSALES POR BANCO, VERIFIQUE." TO MES
         DO AVISO WITH MES
         STORE .F. TO WVERSUCUR
         STORE .F. TO WFLAGSUCUR
      ELSE
         STORE DESCRI TO WDESSUCUR
         STORE .F. TO WVERSUCUR
      ENDIF
   ENDDO
   IF .NOT. WFLAGSUCUR
      LOOP
   ENDIF
   @ 14,20 SAY WDESSUCUR

   STORE "FECHA DE APERTURA DE LA CUENTA" TO MES
   DO MENSAJE WITH MES
   @ 16,12 GET WAPERTURA
   READ

   STORE .T. TO WASKPRE
   DO WHILE WASKPRE
      STORE "INDIQUE EL GRUPO, SUBGRUPO Y RENGLON DE LA CUENTA" TO MES
      DO MENSAJE WITH MES
      @ 18,12 GET WANO
      @ 18,15 GET WTIP
      @ 18,18 GET WORG
      READ
      IF READKEY()=12.OR.READKEY()=268
         STORE .F. TO WASKPRE
         EXIT
      ENDIF
      STORE WANO+WTIP+WORG TO WPRESU
      IF WPRESU  <> SPACE(7)
         SELECT 5
         FIND &WPRESU
         IF EOF()
            STORE "CLASIFICACION NO REGISTRADA" TO MES
            DO AVISO WITH MES
            LOOP
         ELSE
            STORE DESCRI          TO WPRESUDES
            EXIT
         ENDIF
      ELSE
         LOOP
      ENDIF
   ENDDO
   IF .NOT. WASKPRE
      EXIT
   ENDIF
   @ 18,25 SAY WPRESUDES

   STORE .T. TO WGETC
   DO WHILE WGETC
      STORE "NUMERO DEL ULTIMO CHEQUE EMITIDO EN LA CUENTA" TO MES
      DO MENSAJE WITH MES
      @ 20,12 GET WCHEQUE PICTURE "############"
      READ
      IF WCHEQUE > 0
         EXIT
      ENDIF
   ENDDO

   STORE "CONFORME ? (S/N)" TO TEX
   STORE "SN" TO WCH
   DO PREGUNTA
   IF WCH = "N"
      LOOP
   ENDIF
   SELECT 4
   IF WINGRESA
      DO FILLOC
      APPEND BLANK
      UNLOCK
      DO RECLOC
      REPLACE CTA    WITH WCUENTA
      SELECT 6
      DO FILLOC
      APPEND BLANK
      UNLOCK
      DO RECLOC
      REPLACE CTA    WITH WCUENTA
      REPLACE SUBCTA WITH "0000"
      REPLACE DESCRI WITH "UNICA"
      UNLOCK
   ENDIF
   SELECT 4
   DO RECLOC
   REPLACE DESCRI    WITH WDESCRI
   REPLACE TIPO      WITH WTIPO
   REPLACE BANCO     WITH WBANCO
   REPLACE SUCURSAL  WITH WSUCURSAL
   REPLACE NUMEROCTA WITH WNUMCTA
   REPLACE DESCRI    WITH WDESCRI
   REPLACE ANO       WITH WANO
   REPLACE TIP       WITH WTIP
   REPLACE ORG       WITH WORG
   REPLACE APERTURA  WITH WAPERTURA
   REPLACE CHEQUE    WITH WCHEQUE
   FLUSH
   UNLOCK
ENDDO
CLOSE DATA
CLOSE INDEX
RETURN
