SELECT 1
USE BCCTAS INDEX BCCTAS
SELECT 2
USE BCSUBCTA INDEX BCSUBCTA
STORE .T. TO WCARGANDO
DO WHILE WCARGANDO
   @ 4,0 CLEAR to 09,55
   @ 5,0 TO 09,55
   @ 04,00 SAY "SUB-CUENTAS BANCARIAS"
   @ 06,2 SAY "CUENTA :"
   @ 08,2 SAY "SUBCTA :"
   @ 06,11 GET WCUENTA
   READ
   IF WCUENTA = SPACE(4) .OR.READKEY()=12.OR.READKEY()=268
      EXIT
   ENDIF
   SELECT 1
   FIND &WCUENTA
   IF EOF()
      STORE "CUENTA BANCARIA NO EXISTE, VERIFIQUE." TO MES
      DO AVISO WITH MES
      LOOP
   ENDIF
   @ 06,20 SAY DESCRI

   @ 08,11 GET WSUBCUENTA
   READ
   IF WSUBCUENTA = SPACE(4) .OR.READKEY()=12.OR.READKEY()=268
      EXIT
   ENDIF
   SELECT 2
   STORE WCUENTA+WSUBCUENTA TO WCLAVE
   FIND &WCLAVE
   IF EOF()
      STORE .T. TO WINGRESA
      STORE .T. TO WMODIFICA
      STORE "SUB-CUENTA NO REGISTRADA PARA ESTA CUENTA BANCARIA, INGRESAR ? (S/N)" TO TEX
      STORE "SN" TO WCH
      DO PREGUNTA
      IF WCH = "N"
         LOOP
      ENDIF
      STORE SPACE(30) TO WDESCRI
   ELSE
      STORE .F.    TO WINGRESA
      STORE .F.    TO WMODIFICA
      STORE DESCRI TO WDESCRI
   ENDIF
   @ 08,20 SAY WDESCRI

   IF .NOT. WMODIFICA
      STORE "OPCIONES: (M)ODIFICAR, (E)LIMINAR, (S)ALIR" TO TEX
      STORE "SME" TO WCH
      DO PREGUNTA
      STORE WCH TO WRESP
      IF WRESP= "S"
         LOOP
      ELSE
         IF WRESP= "M"
            STORE .T. TO WMODIFICA
         ELSE
            STORE "ESTA SEGURO QUE DESEA ELIMINAR ? (S/N)" TO TEX
            STORE "NS" TO WCH
            DO PREGUNTA
            IF WCH = "N"
               LOOP
            ELSE
               *** CHEQUEAR QUE LA SUBCUENTA ESTE SIN CONEXIONES EN BCOPERAC.DBF
               * SELECT 2
               * DELETE
               * LOOP
            ENDIF
         ENDIF
      ENDIF
   ENDIF

   IF WMODIFICA
      STORE .T. TO WACT
      STORE .T. TO WCARGANDO
      DO WHILE WACT
         @ 08,20 GET WDESCRI
         READ
         IF READKEY()=12.OR.READKEY()=268
            STORE .F. TO WACT
            STORE .F. TO WCARGANDO
            EXIT
         ENDIF
         IF WDESCRI <> SPACE(30)
            STORE .F. TO WACT
         ENDIF
      ENDDO
      IF .NOT. WCARGANDO
         EXIT
      ENDIF
   ENDIF
   STORE "CONFORME ? (S/N)" TO TEX
   STORE "SN" TO WCH
   DO PREGUNTA
   IF WCH = "N"
      LOOP
   ENDIF
   SELECT 2
   IF WINGRESA
      DO FILLOC
      APPEND BLANK
      UNLOCK
      DO RECLOC
      REPLACE CTA     WITH WCUENTA
      REPLACE SUBCTA  WITH WSUBCUENTA
   ENDIF
   DO RECLOC
   REPLACE DESCRI WITH WDESCRI
   FLUSH
   UNLOCK
ENDDO
CLOSE DATA
CLOSE INDEX
RETURN
