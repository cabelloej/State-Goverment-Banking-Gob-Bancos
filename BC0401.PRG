SELECT 1
USE BCBANCOS INDEX BCBANCOS
SELECT 2
USE BCSUCUR  INDEX BCSUCUR
SELECT 3
USE BCCTAS   INDEX BCCTAS
SELECT 4
USE BCOPERA  INDEX BCOPERA2
SELECT 5
USE BCBENEFI INDEX BCBENEF1
SELECT 6
USE BCDATOS
SELECT 10
USE BCMONTO
STORE .F. TO WFLAGIMPRI
STORE .T. TO WEMITIENDO
DO WHILE WEMITIENDO
   SET COLOR TO
   @ 04,00 clear TO 11,79
   @ 04,00 say "EMITIR CHEQUES"
   @ 05,00       TO 11,79
   @ 07,01 SAY "CODIGO DE CUENTA :"
   @ 09,01 SAY "NUMERO DEL CHEQUE:"
   STORE SPACE(04) TO XCUENTA
   STORE SPACE(12) TO XCHEQUE
   @ 07,20 GET XCUENTA
   READ
   IF READKEY()=12.OR.READKEY()=268
      IF WFLAGIMPRI
         SET DEVI TO PRINT
         @ prow(),1 say chr(27)+chr(67)+chr(66)
         SET DEVI TO SCRE
      ENDIF
      EXIT
   ENDIF
   IF XCUENTA <> SPACE(4)
      SELECT 3
      FIND &XCUENTA
      IF EOF()
         STORE "CUENTA NO REGISTRADA, VERIFIQUE" TO MES
         DO AVISO WITH MES
         LOOP
      ENDIF
      STORE BANCO     TO XBANCO
      STORE SUCURSAL  TO XSUCURSAL
      STORE NUMEROCTA TO XNUMEROCTA
      @ 07,25 SAY XNUMEROCTA+"  "+DESCRI
      SELECT 4
      STORE XCUENTA+"CH" TO WCLAVE
      FIND &WCLAVE
      IF EOF()
         STORE "NO HAY CHEQUES ELABORADOS EN ESTA CUENTA, VERIFIQUE" TO MES
         DO AVISO WITH MES
         LOOP
      ENDIF
      @ 09,20 GET XCHEQUE
      READ
      IF READKEY()=12.OR.READKEY()=268
         LOOP
      ENDIF
      IF XCHEQUE <> SPACE(12)
         STORE XCUENTA+"CH"+XCHEQUE TO XCLAVE
         SELECT 4
         FIND &XCLAVE
         IF EOF()
            STORE "CUENTA CODIGO:"+XCUENTA+" CHEQUE No.:"+XCHEQUE+"NO REGISTRADO, VERIFIQUE" TO MES
            DO AVISO WITH MES
            LOOP
         ENDIF
         @ 09,32 SAY MONTO PICTURE "####,###,###.##"
      ENDIF
   ELSE
      @ 07,25 SAY "TODAS LAS CUENTAS"
      @ 09,32 SAY "TODOS LOS CHEQUES"
      SELECT 4
      GO TOP
   ENDIF
   STORE "OPCIONES: (C)ONTINUAR, (S)ALIR" TO TEX
   STORE "SC" TO WCH
   DO PREGUNTA
   IF WCH = "S"
      LOOP
   ENDIF

   SET DEVI TO PRINT
   @ prow(),1 say chr(27)+chr(67)+chr(22)
   SELECT 4
   *** PARA REGRESAR AL PUNTO DE PARTIDA PARA ACTUALIZAR CAMPO EMITIDO
   STORE RECNO() TO WINIEMI
   DO WHILE .NOT. EOF()
      IF ESTATUS = "AN" .OR. TIPOPE <> "CH" .OR. IMPRESO = 1
         SELECT 4
         SKIP
         LOOP
      ENDIF
      IF XCUENTA <> SPACE(4) .AND. CTA <> XCUENTA
         EXIT
      ENDIF
      IF XCHEQUE <> SPACE(12) .AND. NUMOPE <> XCHEQUE
         EXIT
      ENDIF
      STORE CTA    TO WCHCTA
      STORE NUMOPE TO WCHNUMOPE
      STORE FECHA  TO WCHFECHA
      STORE MONTO  TO WCHMONTO
      STORE BENEFI TO WCHBENEFI
      STORE SERIAL TO WCHSERIAL
      SELECT 3
      FIND &WCHCTA
      IF EOF()
         SET DEVI TO SCRE
         STORE "RECHAZO: CUENTA "+WCHCTA+" NO REGISTRADA, CHEQUE:"+WCHNUMOPE TO MES
         DO AVISO WITH MES
         SET DEVI TO PRINT
         SELECT 4
         SKIP
         LOOP
      ELSE
         STORE BANCO     TO WCHBANCO
         STORE SUCURSAL  TO WCHSUCUR
         STORE NUMEROCTA TO WCHNUMCTA
      ENDIF
      SELECT 1
      FIND &WCHBANCO
      IF EOF()
         SET DEVI TO SCRE
         STORE "RECHAZO: BANCO "+WCHBANCO+" DE LA CUENTA:"+WCHCTA+" NO REGISTRADO" TO MES
         DO AVISO WITH MES
         SET DEVI TO PRINT
         SELECT 4
         SKIP
         LOOP
      ELSE
         STORE DESCRI TO WCHBANDES
      ENDIF
      SELECT 2
      STORE WCHBANCO+WCHSUCUR TO WCLAVE
      FIND &WCLAVE
      IF EOF()
         SET DEVI TO SCRE
         STORE "RECHAZO: SUCURSAL "+WCHSUCUR+" BANCO "+WCHBANCO+" CUENTA:"+WCHCTA+" NO REGISTRADA" TO MES
         DO AVISO WITH MES
         SET DEVI TO PRINT
         SELECT 4
         SKIP
         LOOP
      ELSE
         STORE DESCRI TO WCHSUCDES
      ENDIF
      SELECT 5
      FIND &WCHBENEFI
      IF EOF()
         SET DEVI TO SCRE
         STORE "RECHAZO: BENEF."+WCHBENEFI+" CTA."+WCHCTA+" CHEQUE:"+WCHNUMOPE+" NO REG." TO MES
         DO AVISO WITH MES
         SET DEVI TO PRINT
         SELECT 4
         SKIP
         LOOP
      ELSE
         STORE DESCRI TO WCHBENDES
      ENDIF

      *** ELABORACION DE CLAVES DE VALIDACION
      SELECT 6
      do recloc
      REPLACE CLAVE1  WITH CLAVE1 + 1  + DAY(DATE())
      REPLACE CLAVE2  WITH CLAVE1 + 1  + MONTH(DATE())
      unlock
      STORE CLAVE1    TO WCHCLAVE1
      STORE CLAVE2    TO WCHCLAVE2
      STORE WCHSERIAL TO WCHCLAVE3
      *** CALCULO DEL MONTO ESCRITO
      STORE SPACE(50) TO WESCRITO
      STORE WCHMONTO  TO WMONTOESC
      DO MONTOESC

      @ 00,00  SAY CHR(18)
      @ 01,02  SAY CHR(14)+"CUENTA No."
      @ 01,16  SAY CHR(14)+"CHEQUE No."
      @ 01,29  SAY CHR(14)+"BOLIVARES"

      @ 02,02 SAY WCHNUMCTA
      @ 02,29 SAY WCHNUMOPE
      @ 02,54 SAY WCHMONTO PICTURE "****,***,***.**"

      @ 02,00 SAY CHR(15)
      @ 03,04 SAY "REPUBLICA DE VENEZUELA"
      @ 04,04 SAY QQWW
      @ 04,04 SAY CHR(18)

      @ 07,02 SAY "PAGUESE A:"
      @ 07,02 SAY "PAGUESE A:"+WCHBENDES

      @ 09,02 SAY "SON :"
      @ 09,02 SAY "SON :"+chr(15)+WESCRITO
      @ 10,00 say chr(18)

      @ 11,02 SAY "LUGAR Y FECHA:"
      @ 11,02 SAY "LUGAR Y FECHA: BARCELONA, "+SUBSTR(DTOC(WCHFECHA),1,5)+" DE "+STR(YEAR(WCHFECHA),4)
      @ 13,02 SAY CHR(14)+WCHBANDES
      @ 14,02 SAY "SUCURSAL "+WCHSUCDES
      @ 14,40 SAY "------------------------------"
      @ 15,00 SAY CHR(15)
      @ 15,84 SAY "     FIRMAS AUTORIZADAS       "
      @ 15,00 SAY CHR(18)

      @ 16,00 SAY CHR(14)+STR(WCHCLAVE1,12)
      @ 16,13 SAY CHR(14)+STR(WCHCLAVE2,12)
      @ 16,26 SAY CHR(14)+STR(VAL(WCHCLAVE3),12)

      STORE .T. TO WFLAGIMPRI
      SELECT 4
      DO RECLOC
      REPLACE CLAVE1  WITH WCHCLAVE1
      REPLACE CLAVE2  WITH WCHCLAVE2
      REPLACE CLAVE3  WITH VAL(WCHCLAVE3)
      UNLOCK
      SKIP
   ENDDO
   SET DEVI TO SCRE
   IF WFLAGIMPRI
      STORE "ACTUALIZAR CHEQUES A EMITIDOS ? (S/N)  [PRIMERO VERIFIQUE LOS CHEQUES] " TO TEX
      STORE "SN" TO WCH
      DO PREGUNTA
   ELSE
      STORE "N" TO WCH
   ENDIF
   IF WCH = "N"
      LOOP
   ENDIF
   *** CAMBIA EL 0 POR 1 EN CAMPO "IMPRESO" DEL REGISTRO DEL CHEQUE
   SELECT 4
   GO WINIEMI
   DO WHILE .NOT. EOF()
      IF ESTATUS = "AN" .OR. TIPOPE <> "CH"
         SELECT 4
         SKIP
         LOOP
      ENDIF
      IF XCUENTA <> SPACE(4) .AND. CTA <> XCUENTA
         EXIT
      ENDIF
      IF XCHEQUE <> SPACE(12) .AND. NUMOPE <> XCHEQUE
         EXIT
      ENDIF
      DO RECLOC
      REPLACE IMPRESO WITH 1
      UNLOCK
      SELECT 4
      SKIP
   ENDDO
ENDDO
CLOSE DATA
CLOSE INDEX
SET DEVI TO SCRE
RETURN

