*** ELIMINA OPERACIONES BANCARIAS
SET COLOR TO W+/B+
SELECT 3
STORE CTA       TO WCTA
STORE SUBCTA    TO WSUBCTA
STORE TIPOPE    TO WTIPOPE
STORE NUMOPE    TO WNUMOPE
STORE MONTO     TO WMONTO
STORE ESTATUS   TO WESTATUS
STORE ESTATFECHA TO WESTATFECHA

*** VERIFICAR OPERADOR DE LA CUENTA
STORE WUSERCODE+WCUENTA TO WACCESO
SELECT 7
FIND &WACCESO
IF EOF()
   STORE "OPERADOR NO AUTORIZADO EN ESTA CUENTA, VERIFIQUE." TO MES
   DO AVISO WITH MES
   SELECT 3
   RETURN
ENDIF
*** FIN VERIFICACION DE OPERADOR

SELECT 3
IF WESTATUS = "CO"
   STORE "ERROR, ESTA OPERACION ESTA CONCILIADA CON FECHA "+DTOC(WESTATFECHA) TO MES
   DO AVISO WITH MES
   SELECT 3
   RETURN
ENDIF
IF WESTATUS = "AN"
   STORE "ERROR, ESTA OPERACION ESTA ANULADA CON FECHA "+DTOC(WESTATFECHA) TO MES
   DO AVISO WITH MES
   SELECT 3
   RETURN
ENDIF
IF IMPRESO  = 1
   STORE "ERROR, ESTE CHEQUE YA SE IMPRIMIO" TO MES
   DO AVISO WITH MES
   SELECT 3
   RETURN
ENDIF
STORE "ESTA SEGURO QUE DESEA ELIMINAR ? (S/N)" TO TEX
STORE "NS" TO WCH
DO PREGUNTA
IF WCH = "N"
   RETURN
ENDIF

*** ACTUALIZA SUBCTA
STORE WCUENTA+WSUBCUENTA TO WCLAVESUB
SELECT 2
FIND &WCLAVESUB
IF EOF()
   STORE "ERROR FATAL: SUBCUENTA NO LOCALIZADA EN MAESTRO DE SUBCTAS." TO MES
   DO AVISO WITH MES
   STORE "FAVOR REPROCESAR OPERACIONES, OPRIMA ENTER PARA CONTINUAR" TO MES
   DO AVISO WITH MES
   SELECT 3
   RETURN
ENDIF
DO RECLOC
*** REVERSA EL SALDO
IF WTIPOPE = "DP" .OR. WTIPOPE = "NC"
   IF SALDO-WMONTO < 0
      STORE "ADVERTENCIA, SALDO DE LA SUBCUENTA QUEDARA NEGATIVO. DESEA CONTINUAR ? (S/N)" TO TEX
      STORE "NS" TO WCH
      DO PREGUNTA
      IF WCH = "N"
         UNLOCK
         SELECT 3
         RETURN
      ENDIF
   ENDIF
   REPLACE SALDO WITH SALDO-WMONTO
ELSE
   REPLACE SALDO WITH SALDO+WMONTO
ENDIF
UNLOCK
*** ELIMINA OPERACIONE
SELECT 3
DO RECLOC
DELETE
UNLOCK
FLUSH
***
SELECT 3
SKIP
IF .NOT. EOF()
   STORE RECNO() TO WINICIO0
   STORE .T. TO FLAGJUMP0
   STORE RECNO() TO WCLEARREC0
   STORE RECNO() TO WREVERSE0
   STORE WLINE0  TO WEDILIN0
   STORE WLINE0  TO WCLEARLIN0
ELSE
   GO WINICIO0
   SKIP -1
   STORE RECNO() TO WINICIO0
   STORE .T. TO FLAGJUMP0
   STORE 0 TO WREVERSE0
ENDIF
SELECT 3
RETURN

