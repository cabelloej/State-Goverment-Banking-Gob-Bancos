STORE .F. TO FLAGDEL0

SELECT 1
USE BCCTAS INDEX BCCTAS
SELECT 2
USE BCSUBCTA INDEX BCSUBCTA
SELECT 3
USE BCOPERA INDEX BCOPERA1, BCOPERA2, BCOPERA3, BCOPERA4, BCOPERA5
SELECT 4
USE BCREFER INDEX BCREFER
SELECT 5
USE PRBENEF  INDEX PRBENEF1,PRBENEF2
SELECT 6
USE BCDATOS
SELECT 7
USE BCOPECTA INDEX BCOPECTA


@ 4,0 CLEAR
@ 6,0 TO 19,79
STORE "MOVIMIENTOS BANCARIOS" TO WHEADER0
SET COLOR TO W+/B+
@ 4,40 - (LEN(WHEADER0)/2) SAY WHEADER0
SET COLOR TO B+/W+
@ 05,01  SAY "CTA "
@ 05,06  SAY "SCTA"
@ 05,11  SAY "FECHA   "
@ 05,20  SAY "TO"
@ 05,23  SAY "No.OPERACION"
@ 05,36  SAY "DESCRIPCION                 "
@ 05,65  SAY "          MONTO"
STORE  "INCLUIR    " TO XMENU1
STORE  "MODF./ANUL." TO XMENU2
STORE  "ELIMINAR   " TO XMENU3
STORE  "SELECCIONAR" TO XMENU4
STORE  "BUSCAR     " TO XMENU5
STORE 4 TO WMENU0
STORE .T. TO XFLAG0

SELECT 3
GO TOP
STORE .F. TO WREGS0
DO WHILE .NOT. EOF()
   STORE .T. TO WREGS0
   EXIT
ENDDO
IF .NOT. WREGS0
   DO BC0201A
   SELECT 3
ENDIF
GO TOP
STORE .F. TO WREGS0
DO WHILE .NOT. EOF()
   STORE .T. TO WREGS0
   EXIT
ENDDO
IF .NOT. WREGS0
   close data
   close index
   return
ENDIF

STORE 12 TO WRANGO0
STORE RECNO() TO WINICIO0
STORE 0 TO WREVERSE0
STORE 0 TO WEDILIN0
STORE .T. TO FLAGJUMP0

STORE .T. TO WEDITAR0
DO WHILE WEDITAR0
   IF FLAGJUMP0
      STORE 0       TO WCONT0
      STORE 07      TO WLINE0
      GO WINICIO0
      SET COLOR TO W+/B+
      DO WHILE .NOT. EOF() .AND. WCONT0 < WRANGO0
         STORE WLINE0+WCONT0 TO WSCRELIN0
         STORE WLINE0+WCONT0 TO WLASTLIN0
         STORE RECNO() TO WLASTREC0
         @ WSCRELIN0 ,01  SAY CTA
         @ WSCRELIN0 ,06  SAY SUBCTA
         @ WSCRELIN0 ,11  SAY FECHA
         @ WSCRELIN0 ,20  SAY TIPOPE
         @ WSCRELIN0 ,23  SAY NUMOPE
         @ WSCRELIN0 ,36  SAY DESCRI
         @ WSCRELIN0 ,65  SAY MONTO picture "####,###,###.##"
         STORE WCONT0 + 1 TO WCONT0
         SKIP
      ENDDO
      STORE .F. TO FLAGJUMP0
   ENDIF
   *** RELLENO DE ESP. VACIO (SI NO HAY SUF. REGISTROS)
   SET COLOR TO W+/B+
   STORE WCONT0 TO WFILCON
   STORE WLASTLIN0 TO WFILLIN
   DO WHILE WFILCON < WRANGO0
      STORE WFILLIN + 1 TO WFILLIN
      @ WFILLIN, 1 SAY SPACE(79)
      STORE WFILCON + 1 TO WFILCON
   ENDDO
   ***
   IF WREVERSE0 = 0
      STORE WLASTREC0 TO WREVERSE0
      STORE WLASTLIN0 TO WEDILIN0
      STORE WINICIO0  TO WCLEARREC0
      STORE WLINE0    TO WCLEARLIN0
   ENDIF
   ** PARA BORRAR EL REGISTRO ANTERIOR
   SET COLOR TO W+/B+
   GO WCLEARREC0
   STORE WCLEARLIN0 TO WSCRELIN0
   @ WSCRELIN0 ,01  SAY CTA
   @ WSCRELIN0 ,06  SAY SUBCTA
   @ WSCRELIN0 ,11  SAY FECHA
   @ WSCRELIN0 ,20  SAY TIPOPE
   @ WSCRELIN0 ,23  SAY NUMOPE
   @ WSCRELIN0 ,36  SAY DESCRI
   @ WSCRELIN0 ,65  SAY MONTO picture "####,###,###.##"
   ** PARA MARCAR EL REGISTRO ACTUAL
   SET COLOR TO B+/W+
   GO WREVERSE0
   STORE WEDILIN0 TO WSCRELIN0
   @ WSCRELIN0 ,01  SAY CTA
   @ WSCRELIN0 ,06  SAY SUBCTA
   @ WSCRELIN0 ,11  SAY FECHA
   @ WSCRELIN0 ,20  SAY TIPOPE
   @ WSCRELIN0 ,23  SAY NUMOPE
   @ WSCRELIN0 ,36  SAY DESCRI
   @ WSCRELIN0 ,65  SAY MONTO picture "####,###,###.##"
   STORE WREVERSE0 TO WCLEARREC0
   STORE WSCRELIN0 TO WCLEARLIN0

   *** INICIO DE MUESTRA EL RESTO DE LOS DATOS DEL REGISTRO
   SET COLOR TO W+/B+
   @ 21,00 CLEAR
   @ 21,00 SAY "CUENTA:"
   @ 22,00 SAY "SUBCTA:"
   @ 23,00 SAY "ESTAT.:"
   @ 21,40 SAY "RFCIA.:"
   @ 22,40 SAY "SUBSLD:"
   @ 23,40 SAY "BENEF.:"
   SET COLOR TO W+/B+
   STORE CTA     TO WCUENTA
   STORE SUBCTA  TO WSUBCUENTA
   STORE TIPREF  TO WTIPREF
   STORE NUMREF  TO WNUMREF
   STORE BENEFI  TO WBENEFI
   STORE ESTATUS TO WESTATUS
   SELECT 1
   FIND &WCUENTA
   IF EOF()
      STORE "NO REGISTRADA" TO WCTADES
   ELSE
      STORE DESCRI          TO WCTADES
   ENDIF
   STORE WCUENTA+WSUBCUENTA  TO WCLAVESUB
   SELECT 2
   FIND &WCLAVESUB
   IF EOF()
      STORE "NO REGISTRADA" TO WSUBDESCRI
   ELSE
      STORE DESCRI          TO WSUBDESCRI
   ENDIF
   STORE SALDO TO WSALDO

   SELECT 4
   FIND &WTIPREF
   IF EOF()
      STORE SPACE(30) TO WREFDES
   ELSE
      STORE DESCRI    TO WREFDES
   ENDIF
   IF WBENEFI <> SPACE(12)
      SELECT 5
      FIND &WBENEFI
      IF EOF()
         STORE "NO REGISTRADO"  TO WBENEFIDES
      ELSE
         STORE DESCRI           TO WBENEFIDES
      ENDIF
   ELSE
      STORE SPACE(30)           TO WBENEFIDES
   ENDIF
   IF WESTATUS = "ET"
      STORE "TRANSITO" TO WESTATDES
   ELSE
      IF WESTATUS = "CO"
         STORE "CONCDA. " TO WESTATDES
      ELSE
         IF WESTATUS = "AN"
            STORE "ANULADA " TO WESTATDES
         ELSE
            STORE "????????" TO WESTATDES
         ENDIF
      ENDIF
   ENDIF
   SELECT 3
   @ 21,08 SAY WCTADES
   @ 22,08 SAY WSUBDESCRI
   @ 23,08 SAY WESTATDES
   @ 21,47 SAY ALLTRIM(WREFDES)+"No."+ALLTRIM(WNUMREF)
   @ 22,47 SAY WSALDO PICTURE "####,###,###.##"
   @ 23,47 SAY WBENEFIDES
   *** FIN DE MUESTRA EL RESTO DE LOS DATOS DEL REGISTRO

   *** PARA INDICAR LA ROTACION DEL MENU (SI LA HUBO)
   IF XFLAG0
      SET COLOR TO W+/B+
      @ 20,05 SAY  XMENU1
      @ 20,20 SAY  XMENU2
      @ 20,35 SAY  XMENU3
      @ 20,50 SAY  XMENU4
      @ 20,65 SAY  XMENU5

      SET COLOR TO B/W+
      STORE "XMENU"+STR(WMENU0,1) TO WMACRO
      @ 20,5+((WMENU0-1)*15)  SAY &WMACRO
      STORE .F. TO XFLAG0
      SET COLOR TO W/B+
   ENDIF

   *SET COLOR TO G/N
   *** CAPTURA DE INTERACTIVIDAD
   CLEAR TYPEAHEAD
   STORE INKEY(0) TO WMUEVE0
   *** PAGE DOWN
   IF WMUEVE0 = 3
      GO WINICIO0
      SKIP +12
      IF .NOT. EOF()
         STORE RECNO() TO WINICIO0
         STORE .T.     TO FLAGJUMP0
         STORE WINICIO0 TO WREVERSE0
         STORE WLINE0   TO WEDILIN0
         STORE WINICIO0 TO WCLEARREC0
         STORE WLINE0   TO WCLEARLIN0
      ENDIF
   ENDIF
   *** PAGE UP
   IF WMUEVE0 =  18
      GO WINICIO0
      SKIP -12
      STORE RECNO() TO WINICIO0
      STORE .T. TO FLAGJUMP0
      STORE 0 TO WREVERSE0
   ENDIF
   *** HOME
   IF WMUEVE0 = 1
      GO TOP
      IF .NOT. EOF()
         STORE RECNO() TO WINICIO0
         STORE .T. TO FLAGJUMP0
         STORE WINICIO0 TO WREVERSE0
         STORE WLINE0   TO WEDILIN0
         STORE WINICIO0 TO WCLEARREC0
         STORE WLINE0   TO WCLEARLIN0
      ENDIF
   ENDIF
   *** END
   IF WMUEVE0 = 6
      GO BOTT
      SKIP -11
      STORE RECNO() TO WINICIO0
      STORE 0 TO WREVERSE0
      STORE .T. TO FLAGJUMP0
   ENDIF
   *** DOWN ARROW
   IF WMUEVE0 = 24
      SKIP + 1
      IF WEDILIN0 < (WLINE0+(WCONT0-1))
         STORE WREVERSE0    TO WCLEARREC0
         STORE RECNO()     TO WREVERSE0
         STORE WEDILIN0     TO WCLEARLIN0
         STORE WEDILIN0 + 1 TO WEDILIN0
      ELSE
         IF .NOT. EOF()
            GO WINICIO0
            SKIP +1
            STORE RECNO() TO WINICIO0
            STORE .T.     TO FLAGJUMP0
            STORE 0       TO WREVERSE0
         ELSE
            GO WINICIO0
            STORE RECNO() TO WINICIO0
            STORE .T.     TO FLAGJUMP0
            STORE 0       TO WREVERSE0
         ENDIF
      ENDIF
   ENDIF
   *** UP ARROW
   IF WMUEVE0 = 5
      SKIP -1
      IF WEDILIN0 > WLINE0
         STORE WREVERSE0    TO WCLEARREC0
         STORE RECNO()     TO WREVERSE0
         STORE WEDILIN0     TO WCLEARLIN0
         STORE WEDILIN0 - 1 TO WEDILIN0
      ELSE
         GO WINICIO0
         SKIP -1
         STORE RECNO() TO WINICIO0
         STORE .T.     TO FLAGJUMP0
         STORE WINICIO0 TO WREVERSE0
         STORE WLINE0   TO WEDILIN0
         STORE WINICIO0 TO WCLEARREC0
         STORE WLINE0   TO WCLEARLIN0
      ENDIF
   ENDIF
   *** RIGHT ARROW
   IF WMUEVE0 = 4
      STORE .T. TO XFLAG0
      STORE WMENU0+1 TO WMENU0
      IF WMENU0 > 5
         STORE 1 TO WMENU0
      ENDIF
   ENDIF
   *** LEFT ARROW
   IF WMUEVE0 = 19
      STORE .T. TO XFLAG0
      STORE WMENU0-1 TO WMENU0
      IF WMENU0 < 1
         STORE 5 TO WMENU0
      ENDIF
   ENDIF
   *** ESCAPE
   IF WMUEVE0 = 27
   *  STORE SPACE(29) TO WCODIGO0
   *  STORE SPACE(29) TO WCUENTA0
      CLOSE DATA
      CLOSE INDEX
      RETURN
   ENDIF
   *** ENTER (INICIO DE OPERACIONES DE ACTUALIZACION DE DATOS
   IF WMUEVE0 = 13
   *  store space(29) to WCODIGO0
   *  store space(29) to WCUENTA0
      DO CASE    
         CASE WMENU0 = 1
              DO BC0201A
              SELECT 3
         CASE WMENU0 = 2
              do recloc
              DO BC0201B
              select 3
              unlock 
         CASE WMENU0 = 3
              do recloc
              DO BC0201C
              unlock
         CASE WMENU0 = 4
              STORE CTA    TO WCUENTA
              STORE SUBCTA TO WSUBCUENTA
              STORE TIPOPE TO WTIPOPE
              STORE FECHA  TO WFECHA
              STORE NUMOPE TO WNUMOPE
              STORE MONTO  TO WMONTO
              CLOSE DATA
              CLOSE INDEX
              RETURN
         CASE WMENU0 = 5
              SAVE SCRE TO S9
              SET COLOR TO B+/W+
              @ WSCRELIN0 ,01  GET WCUENTA
              @ WSCRELIN0 ,06  GET WSUBCUENTA
              READ
              STORE WCUENTA+WSUBCUENTA TO WCLAVE
              IF WCLAVE <> SPACE(8)
                 FIND &WCLAVE
                 IF .NOT. EOF()
                    STORE RECNO() TO WINICIO0
                    STORE .T. TO FLAGJUMP0
                    STORE RECNO() TO WREVERSE0
                    STORE RECNO() TO WCLEARREC0
                    STORE WLINE0   TO WEDILIN0
                    STORE WLINE0   TO WCLEARLIN0
                 ELSE
                    STORE "CODIGO NO REGISTRADO. <ENTER>" TO MES
                    DO AVISO WITH MES
                    RESTORE SCRE FROM S9
                 ENDIF
              ELSE
                 RESTORE SCRE FROM S9
              ENDIF
      ENDCASE
   ENDIF
ENDDO
CLOSE DATA
CLOSE INDEX
RETURN
